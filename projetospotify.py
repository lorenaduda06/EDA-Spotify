# -*- coding: utf-8 -*-
"""projetoSpotify.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1XiNQ10BkYXB1CTXHaof6mivp6LFOz2-A

**AN√ÅLISE EXPLORAT√ìRIA DE DADOS: SPOTIFY SONGS**

Este projeto analisa um conjunto de dados referentes a mais de 30000 faixas do Spotify, desde 1957 at√© o ano de 2020.

O intuito √© identificar como as caracter√≠sticas musicais influenciam a popularidade das m√∫sicas.
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px

df = pd.read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2020/2020-01-21/spotify_songs.csv")

"""Nessa etapa as colunas foram traduzidas para o portugu√™s, com o intuito de facilitar a an√°lise dos dados

Al√©m disso, os valores das colunas **tom** e **modo** foram mapeados para seus nomes reais. E foi criada uma coluna com os valores da dura√ß√£o convertidos para minutos.

E tamb√©m campos que antes estavam nulos, agora eles s√£o apresentados como "N√£o informados".
"""

update_columns = {
    "track_id": "id_faixa",
    "track_name": "nome_faixa",
    "track_artist": "artista",
    "track_popularity": "popularidade",
    "track_album_id": "id_album",
    "track_album_name": "nome_album",
    "track_album_release_date": "lancamento",
    "playlist_name": "playlist",
    "playlist_id": "id_playlist",
    "playlist_genre": "genero",
    "playlist_subgenre": "subgenero",
    "danceability": "dancabilidade",
    "energy": "intensidade",
    "key": "tom",
    "loudness": "volume",
    "mode": "modo",
    "speechiness": "indice_vocal",
    "acousticness": "acustica",
    "instrumentalness": "instrumentalidade",
    "liveness": "indice_performance",
    "valence": "valencia",
    "tempo": "ritmo",
    "duration_ms": "duracao_ms"
}

df = df.rename(columns=update_columns)
print(df.columns)

df.head()

update_tom_values = {
    0: "D√≥",
    1: "D√≥ sustenido",
    2: "R√©",
    3: "R√© sustenido",
    4: "Mi",
    5: "F√°",
    6: "F√° sustenido",
    7: "Sol",
    8: "Sol sustenido",
    9: "L√°",
    10: "L√° sustenido",
    11: "Si"
}

df["tom"] = df["tom"].replace(update_tom_values)
df["tom"].value_counts()

update_modo_values = {
    0: "Menor",
    1: "Maior"
}

df["modo"] = df["modo"].replace(update_modo_values)
df["modo"].value_counts()

df["lancamento"] = pd.to_datetime(df["lancamento"], format="mixed")
df["lancamento"] = df["lancamento"].dt.year

df["duracao_min"] = df["duracao_ms"] / 60000

df["nome_faixa"] = df["nome_faixa"].fillna("N√£o informado")
df["artista"] = df["artista"].fillna("N√£o informado")
df["nome_album"] = df["nome_album"].fillna("N√£o informado")

df.isnull().sum()

"""Etapa de an√°lise dos gr√°ficos"""

# AN√ÅLISE DAS FAIXAS COM POPULARIDADE MAIOR QUE ZERO
popularidade_maior_que_zero = df[df["popularidade"] > 0]
popularidade_alta = popularidade_maior_que_zero["popularidade"]

plt.figure(figsize=(14,7))
sns.histplot(
    data=popularidade_alta,
    bins=30,
    kde=True
)
plt.title("Distribui√ß√£o de Popularidade das Faixas")
plt.xlabel("Popularidade")
plt.ylabel("Frequ√™ncia")
plt.show()

"""üìä Distribui√ß√£o de Popularidade das Faixas

Foram filtradas apenas as m√∫sicas com popularidade maior que zero. Isso porque foi verificado anteriormente um volume massivo de faixas com esse valor de popularidade. O que indica que grande parte do cat√°logo do Spotify pode ser composta por lan√ßamentos muito recentes (conforme os anos registrados no DataFrame) ou at√© mesmo por faixas antigas que acabaram ficando esquecidas com o tempo, e por esse motivo n√£o entraram no ciclo de recomenda√ß√£o do algoritmo.

Observa-se que a maior parte das m√∫sicas analisadas apresentam n√≠vel de popularidade por volta do valor 60 (moda). Portanto atingir esse n√≠vel √© considerado como "padr√£o de sucesso" para a maioria das m√∫sicas que conseguem sair da in√©rcia.

Ademais, tamb√©m nota-se que ap√≥s o valor 80 a curva cai significativamente. Tal fator nos permite concluir que essa regi√£o que abriga os hits globais √© simultaneamente restrita e competitiva.
"""

# IDENTIFICA√á√ÉO DO G√äNERO QUE APRESENTA MAIS FAIXAS SEM POPULARIDADE
menor_popularidade = df[df["popularidade"] == 0]
genero_menos_popular = menor_popularidade["genero"].value_counts().reset_index()

plt.figure(figsize=(14,7))
sns.barplot(
    data=genero_menos_popular,
    x="genero",
    y="count",
    hue="genero",
    palette="viridis"
)
plt.title("G√™neros Menos Populares")
plt.xlabel("G√™nero")
plt.ylabel("Quantidade")
plt.show()

"""üìä G√™neros Menos Populares

A an√°lise do gr√°fico indica que o g√™nero menos popular √© o EDM (Eletronic Dance Music). Em sequ√™ncia r&b ocupa a segunda posi√ß√£o de g√™nero que mais apresenta faixas menos populares.

Portanto, nota-se que muitos lan√ßamentos n√£o alcan√ßam tra√ß√£o inicial.
"""

# RELA√á√ÉO ENTRE POPULARIDADE E TEMPO
qtd_faixas = df.sample(2000)

fig = px.scatter(
    qtd_faixas,
    x="popularidade",
    y="lancamento",
    color="lancamento",
    title="Rela√ß√£o entre Popularidade e Tempo",
    hover_name="nome_faixa",
    hover_data=["artista"],
    labels={"popularidade": "Popularidade", "lancamento": "Ano"}
)
fig.show()

"""üìä Rela√ß√£o entre Popularidade e Tempo

A an√°lise do gr√°fico retrata que o n√≠vel mais alto de popularidade, entre os valores 80-100 s√£o ocupados por faixas mais recentes.

Enquanto que m√∫sicas dos anos 80 ocupam em m√©dia popularidade entre os valores 40 e 60.

Por fim, faixas da d√©cada de 1960 s√£o as que apresentam menor popularidade.
"""

# CONTAGEM DE G√äNEROS
ordem = df["genero"].value_counts().index

plt.figure(figsize=(16,7))
sns.countplot(
    data=df,
    x="genero",
    order=ordem
)
plt.title("Contagem de G√™neros")
plt.xlabel("G√™nero")
plt.ylabel("Quantidade")
plt.show()

"""üìä Contagem de G√™neros

O gr√°fico apresenta a distribui√ß√£o dos g√™neros musicais presentes no conjunto de dados.

Nota-se que o g√™nero mais frequente no DataFrame √© o EDM (Eletronic Dance Music). Ao passo que o g√™nero com menor recorr√™ncia entre as faixas √© o rock.

Contudo, apesar das diferen√ßas de volume de dados, os seis g√™neros tem uma base de dados robusta para an√°lises commparativas.
"""

# AN√ÅLISE DA VARIA√á√ÉO DE POPULARIDADE PARA CADA G√äNERO
plt.figure(figsize=(14,7))
sns.boxplot(
    data=df,
    x="popularidade",
    y="genero",
    hue="genero",
    palette="viridis"
)
plt.title("Distribui√ß√£o de Popularidade por G√™nero")
plt.xlabel("Popularidade")
plt.ylabel("G√™nero")
plt.show()

"""üìä Distribui√ß√£o de Popularidade por G√™nero

A an√°lise do gr√°fico nos permite verificar que o g√™nero com a maior mediana de popularidade √© o Pop, ao passo em que o EDM apresenta o menor valor de engajamento.

Esse aspecto prova que uma m√∫sica Pop tem, de modo geral, maior probabilidade de ser bem aceita pelo p√∫blico quando comparada aos outros g√™neros.

Os g√™neros Latim e Rap t√™m valores de medianas pr√≥ximas e performance mais est√°vel, considerando que suas caixas s√£o mais compactas. O Rock apresenta grande amplitude, por isso o sucesso neste g√™nero pode variar significativamente entre as faixas.

N√£o foram apresentados outliers vis√≠veis, os whiskers alcan√ßam os extremos, indicando que todos os g√™neros tem m√∫sicas que variam entre pouco e muito populares.
"""

# AN√ÅLISE DA M√âDIA DE DAN√áABILIDADE POR G√äNERO
ordem = df.groupby("genero")["dancabilidade"].mean().sort_values(ascending=False).index

plt.figure(figsize=(14,5))
sns.barplot(
    data=df,
    x="genero",
    y="dancabilidade",
    order=ordem
)
plt.title("M√©dia de Dan√ßabilidade por G√™nero")
plt.xlabel("G√™nero")
plt.ylabel("Dan√ßabilidade")
plt.show()

"""üìä M√©dia de Dan√ßabilidade por G√™nero

A an√°lise do gr√°fico nos permite compreender o perfil r√≠tmico de cada g√™nero. Nesse sentido, a dan√ßabilidade √© uma m√©trica constitu√≠da pela uni√£o de elementos como estabilidade do ritmo e intensidade da batida.

Nota-se que o g√™nero com a maior m√©dia de dan√ßabilidade √© o Rap, seguido pelo Latim, que tamb√©m apresenta uma m√©dia elevada.

Ademais, o Rock cont√©m menor m√©dia de dan√ßabilidade. Isso porque a estrutura das m√∫sicas desse g√™nero utilizam ritmos mais complexos e variam consideravelmente sua faixa de BPM (desde faixas lentas e pesadas at√© faixas muito velozes).

Conforme analisado anteriormente, por mais que o Pop seja o g√™nero mais popular, ele ocupa a pen√∫ltima posi√ß√£o de dan√ßabilidade. Tal fator permite observar que outros aspectos podem ser considerados mais relevantes para caracterizar o sucesso de um g√™nero do que apenas a caracter√≠stica de dan√ßabilidade.
"""

# AN√ÅLISE DA M√âDIA DE INTENSIDADE POR ARTISTA
ordem = df.groupby("artista")["intensidade"].mean().sort_values(ascending=False).head(10).index

plt.figure(figsize=(14,7))
sns.barplot(
    data=df,
    x="intensidade",
    y="artista",
    order=ordem,
    palette="viridis",
    hue="artista",
    legend=False
)
plt.title("M√©dia de Intensidade por Artista (Top 10)")
plt.xlabel("Intensidade")
plt.ylabel("Artista")
plt.show()

"""üìä M√©dia de Intensidade por Artista (Top 10)

A intensidade abrange a percep√ß√£o de ru√≠do, intensidade e volume da faixa, sendo uma medida de car√°ter t√©cnico e auditivo.

A an√°lise do gr√°fico nos permite identificar que os 10 artistas com maior valor para a m√©trica de intensidade, est√£o situados em posi√ß√µes muito pr√≥ximas. Tal aspecto indica que o cat√°logo destes √© constitu√≠do por faixas muito energ√©ticas.

Nature Sounds e Rain Recordings est√£o no topo do ranking, isso se deve ao fato de que o algoritmo do Spotify processa ru√≠dos como alta energia sonora. Al√©m disso, Captain Jack e Nari & Milani s√£o artistas cujo g√™nero das faixas √© fortemente voltado para pistas de dan√ßa.
"""

# RANKING 5 ARTISTAS MAIS POPULARES
qtd_musicas_por_artista = df["artista"].value_counts()

artistas_populares = qtd_musicas_por_artista[qtd_musicas_por_artista > 10].index

popularidade_alta = df[df["artista"].isin(artistas_populares)]

ranking_artistas = popularidade_alta.groupby("artista")["popularidade"].mean().sort_values(ascending=False).head(5).reset_index()

plt.figure(figsize=(14,7))
sns.barplot(
    data=ranking_artistas,
    x="artista",
    y="popularidade",
    hue="artista",
    palette="viridis",
    legend=False
)
plt.title("Ranking Top 5 Artistas Mais Populares")
plt.xlabel("Artista")
plt.ylabel("Popularidade")
plt.show()

"""üìä Ranking Top 5 Artistas Mais Populares

O gr√°fico apresenta apenas artistas que possuem mais de 10 faixas registradas no cat√°logo, a fim de garantir relev√¢ncia estat√≠stica.

No topo do ranking est√£o Roddy Ricch e DaBaby, ambos artistas associados ao g√™nero Rap. Tal fator confirma o sucesso desse g√™nero por volta do ano de 2020, como j√° havia sido verificada em gr√°ficos anteriores.

O artista com maior n√≠vel de popularidade na plataforma √© o Roddy Ricch, ao passo que MEDUZA apresenta o menor valor para essa categoria. No entanto, nota-se que a diferen√ßa entre eles √© m√≠nima.

Portanto no topo do ranking, o n√≠vel de engajamento √© significativamente elevado e est√°vel.
"""

# AN√ÅLISE DA M√âDIA DE DAN√áABILIDADE AO LONGO DOS ANOS
evolucao_dancabilidade = df.groupby("lancamento")["dancabilidade"].mean().reset_index()

plt.figure(figsize=(14,7))
sns.lineplot(
    data=evolucao_dancabilidade,
    x="lancamento",
    y="dancabilidade"
)
plt.xlabel("Lan√ßamento");
plt.ylabel("Dan√ßabilidade")
plt.title("M√©dia de Dan√ßabilidade ao Longo dos Anos")
plt.show()

"""üìä M√©dia de Dan√ßabilidade ao Longo dos Anos

A an√°lise do gr√°fico nos permite identificar a evolu√ß√£o do comportamento r√≠tmico das faixas conforme mudan√ßas culturais e tecnol√≥gicas ocorridas ao passar dos anos.

Observa-se que na d√©cada de 60 houve uma queda abrupta da faixa de dan√ßabilidade. Isso porque h√° poucos registros de faixas desse per√≠odo, sobretudo com baixa dan√ßabilidade.

Enquanto que a partir dos anos 80, os valores foram crescendo de forma significativa.

A partir dos anos 2000 os valores assumiram estabilidade em alto n√≠vel. Portanto as faixas mais atuais s√£o frequentemente consideradas dan√ß√°veis.
"""

# AN√ÅLISE DA M√âDIA DE DAN√áABILIDADE POR G√äNERO
media_dancabilidade = df.groupby("genero")["dancabilidade"].mean().sort_values(ascending=False).reset_index()

fig = px.bar(
    media_dancabilidade,
    x="genero",
    y="dancabilidade",
    title="M√©dia de Dan√ßabilidade por G√™nero",
    labels={"genero": "G√™nero", "dancabilidade": "Dan√ßabilidade"},
    color="genero"
)
fig.show()

"""üìä M√©dia de Dan√ßabilidade por G√™nero

O gr√°fico reafirma an√°lises feitas anteriormente, por√©m, agora com maior precis√£o t√©cnica.

O Rap √© considerado o g√™nero mais dan√ß√°vel, seguido pelo Latim. A distin√ß√£o de cores por g√™nero permite r√°pida associa√ß√£o visual entre diferentes m√©tricas j√° analisadas.

Observa-se que a diferen√ßa entre as duas primeiras posi√ß√µes √© m√≠nima.

Ademais, o Rock permanece na sexta posi√ß√£o. Isso porque sua estrutura musical apresenta complexidade sonora.
"""

# AN√ÅLISE DA RELA√á√ÉO ENTRE INTENSIDADE E VOLUME
qtd_faixas = df.sample(1000)

fig = px.scatter(
    qtd_faixas,
    x="intensidade",
    y="volume",
    title="Rela√ß√£o entre Intensidade e Volume",
    hover_name="nome_faixa",
    hover_data=["artista"],
    color="genero",
    labels={"genero": "G√™nero"}
)
fig.show()

"""üìä Rela√ß√£o entre Intensidade e Volume

O gr√°fico explora a rela√ß√£o entre intensidade e volume das faixas.

Nota-se que √† medida que a intensidade aumenta, o volume tende a subir.

Ademais, g√™neros EDM e Rap est√£o mais concentrados no quadrante superior direito, o que indica que essas faixas cont√©m alto impacto sonoro.

Tamb√©m observa-se que quase n√£o h√° presen√ßa de faixas com baixa intensidade e alto volume ou vice-versa.
"""

# AN√ÅLISE DA RELA√á√ÉO ENTRE POPULARIDADE E MODO
popularidade_maior_que_zero = df[df["popularidade"] > 0]

fig = px.histogram(
    popularidade_maior_que_zero,
    x="popularidade",
    facet_col="modo",
    nbins=30,
    title="Distribui√ß√£o de Popularidade por Modo"
)
fig.for_each_annotation(lambda a: a.update(text=a.text.split("=")[-1]))

fig.update_layout(showlegend=False)
fig.show()

"""üìä Distribui√ß√£o de Popularidade por Modo

A an√°lise do gr√°fico permite compreender que em decorr√™ncia da semelhan√ßa de ambos os gr√°ficos, a escala (maior ou menor) n√£o determina diretamente o n√≠vel de popularidade da m√∫sica.

Ademais, o primeiro gr√°fico apresenta barras mais altas para o eixo de count, indicando maior presen√ßa de faixas pertencentes a escalas maiores.

Em rela√ß√£o a moda, este valor se situa por volta de 60, e conforme analisado anteriormente, esta √© a √°rea de "sucesso" das faixas.

Ao alcan√ßar o valor 80, os valores pertencentes a ambas as escalas apresentam queda. Portanto atingir o auge global √© igualmente dif√≠cil para os 2 modos de escala musical.
"""